{% extends "base.html" %}

{% block content %}

<div class="book-container">

    <!-- NOWY KONTENER GRID DLA G√ìRNEJ SEKCJI (KARTA + EDYCJA) -->
    <div class="top-section-grid">

        <!-- 1. KARTA KSIƒÑ≈ªKI (INFORMACJE) -->
        <div class="book-card">
            <h1 class="book-title">{{ book['title'] }}</h1>

            <div class="book-details-main">

                {% if book['thumbnail'] %}
                    <img src="{{ book['thumbnail'] | safe }}" alt="Book cover" class="book-cover-image">
                {% endif %}

                <div class="book-metadata-wrapper">
                    <div class="details-grid">
                        <p class="book-meta"><strong>Author:</strong> {{ book['author'] }}</p>
                        <p class="book-meta"><strong>Category:</strong> {{ book['category'] }}</p>
                        <p class="book-meta"><strong>Added:</strong> {{ book['date_added'] }}</p>
                        <p class="book-meta"><strong>Status:</strong> {{ book['status'] }}</p>

                        {% if book['status'] == 'Completed' %}
                        <p class="book-meta finished"><strong>Completed:</strong> {{ book['date_finished'] }}</p>
                        {% endif %}

                        {% if book['rating'] %}
                        <p class="book-meta rating">
                            <strong>Rating:</strong> ‚≠ê {{ book['rating'] }}/10

                            {% if book['review'] %}
                            - <span class="review-button" onclick="openReviewModal(event)">üìñ Review</span>
                            {% endif %}
                        </p>
                        {% endif %}

                        <div id="reviewModal" class="modal">
                            <div class="modal-content">
                                <span class="close" onclick="closeReviewModal()">&times;</span>
                                <h3>üìñ Your Review</h3>
                                <p>"{{ book['review'] }}"</p>
                            </div>
                        </div>

                    </div>
                </div>
                </div>
            </div>

        <!-- 2. KARTA EDYCJI (PRZENIESIONA NA ZEWNƒÑTRZ DLA UK≈ÅADU GRID) -->
        <div class="card edit-card">
            <h3>‚úèÔ∏è Edit Details</h3>
            <form action="{{ url_for('edit_book_route', book_id=book['id']) }}" method="POST" class="form">
                <input type="text" name="title" value="{{ book['title'] }}" placeholder="Title">
                <input type="text" name="author" value="{{ book['author'] }}" placeholder="Author">
                <input type="text" name="category" value="{{ book['category'] }}" placeholder="Category">
                <button type="submit" class="btn-primary">üíæ Save Changes</button>
            </form>
        </div>

    </div>

    <!-- 3. KARTA RECENZJI (BƒòDZIE ZAJMOWAƒÜ CA≈ÅƒÑ SZEROKO≈öƒÜ) -->
    <div class="card review-card">
        <h3>‚≠ê {% if book['rating'] %}Edit {% else %}Add{% endif %} Review</h3>
        <form action="{{ url_for('complete', book_id=book['id']) }}" method="POST" class="form">
            <input type="number" name="rating" min="1" max="10"
                   value="{{ book['rating'] or '' }}"
                   placeholder="Rating (1‚Äì10)" required>
            <textarea name="review" placeholder="Your review..." rows="5" class="resizable-textarea">{{ book['review'] or '' }}</textarea>
            <button type="submit" class="btn-secondary">
                {% if book['rating'] %}üíæ Update Review{% else %}‚≠ê Submit Review{% endif %}
            </button>
        </form>
    </div>




    <!-- 4. STOPKA AKCJI (LINK + DANGER ZONE) -->
    <div class="action-footer">

        <a href="{{ url_for('index') }}" class="back-link">‚¨ÖÔ∏è Back to List</a>

        <!-- Strefa niebezpiecze≈Ñstwa (PRZENIESIONA NA D√ì≈Å PO PRAWEJ) -->
        <div class="card danger-zone">
            <h3>‚ö†Ô∏è Danger Zone</h3>
            <form id="deleteForm" action="{{ url_for('delete', book_id=book['id']) }}" method="POST">
                <button type="button" class="btn-danger" onclick="confirmDelete('{{ book['title'] }}', '{{ book['author'] }}')">
                    üóëÔ∏è Delete Book
                </button>
            </form>
        </div>

    </div>

    <!-- UWAGA: Kontener book-actions zosta≈Ç usuniƒôty, poniewa≈º jego zawarto≈õƒá zosta≈Ça rozbita. -->

</div>




<script>
    function confirmDelete(title, author) {
        const confirmed = confirm(`Are you sure you want to delete "${title}" by ${author}`);
        if (confirmed) {
            document.getElementById('deleteForm').submit();
        }
    }


    function openReviewModal(event) {
    event.preventDefault();
    document.getElementById('reviewModal').style.display = 'block';
}

    function closeReviewModal() {
        document.getElementById('reviewModal').style.display = 'none';
    }

    // klikniƒôcie poza modal zamyka popup
    window.onclick = function(event) {
        const modal = document.getElementById('reviewModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>


{% endblock %}